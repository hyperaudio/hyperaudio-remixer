<!doctype html>
<html>
<head>
  <title>Hyperaudio Pad</title>
  <meta charset='utf-8' />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* custom reset */
    .hyperaudio-pad {
      box-sizing: border-box;
      background-color: white;
      margin: 0;
      padding: 0;
      border: 0;
      outline: 0;
      font-size: 1rem;
      font-weight: 400;
      line-height: 1;
      vertical-align: baseline;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .hyperaudio-pad *, .hyperaudio-pad *:before, .hyperaudio-pad *:after {
      box-sizing: inherit;
    }

    .hyperaudio-pad input[type] {
      user-select: text;
      appearance: none;
      border: 0;
      padding: 0;
      margin: 0;
      min-width: 0;
      font-size: 1rem;
      font-family: inherit;
      text-transform: none;
    }

    .hyperaudio-pad input:focus {
      outline: 0;
    }

    .hyperaudio-pad input::-ms-clear {
      display: none;
    }

    .hyperaudio-pad input::-ms-reveal {
      display: none;
    }

    .hyperaudio-pad select:-moz-focusring {
      color: transparent;
      text-shadow: 0 0 0 #000;
    }

    .hyperaudio-pad div, .hyperaudio-pad section, .hyperaudio-pad article, .hyperaudio-pad header, .hyperaudio-pad video, .hyperaudio-pad audio, .hyperaudio-pad footer, .hyperaudio-pad p {
      border: 0;
      outline: 0;
      margin: 0;
      padding: 0;
      display: block;
    }

    .hyperaudio-pad span {
      border: 0;
      outline: 0;
      margin: 0;
      padding: 0;
      font-size: 1rem;
      font-weight: 400;
      /* line-height: 1; */
      line-height: 1.66em;
    }

    .hyperaudio-pad script, .hyperaudio-pad style {
      display: none;
    }

    .hyperaudio-pad a {
      text-decoration: none;
      color: inherit;
      cursor: pointer;
    }

    .hyperaudio-pad a:focus, .hyperaudio-pad a:active, .hyperaudio-pad a:hover {
      text-decoration: none;
      outline: 0;
    }

    .hyperaudio-pad b {
      font-weight: 400;
    }

    .hyperaudio-pad em, .hyperaudio-pad i {
      font-style: normal;
    }

    .hyperaudio-pad svg {
      display: block;
    }

    .hyperaudio-pad img, .hyperaudio-pad video, .hyperaudio-pad audio {
      max-width: 100%;
      height: auto;
      display: block;
      border-style: none;
    }

  </style>
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rangeslider.js/2.3.2/rangeslider.css" /> -->
  <link rel="stylesheet" href="./rangeslider.css" />
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/easy-autocomplete/1.3.5/easy-autocomplete.css"> -->
  <link rel="stylesheet" href="./easy-autocomplete.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/easy-autocomplete/1.3.5/easy-autocomplete.themes.css"> -->
  <style>
    /* demo layout */
    html, body {
      /* background-color: black; */
      font-family: 'Kepler Std', 'Kepler W01 Regular', Georgia, "Times New Roman", Times, serif;
      line-height: 1.66em;
    }

    /* main container */
    .hyperaudio-pad {
      display: flex;
      flex-direction: column;
      text-align: left;
      background-color: white;
      padding: 2em;
      color: #1a1a1a;
    }

    .hyperaudio-pad > div {
      flex-basis: 100%;
      display: flex;
    }

    /* each column */
    .hyperaudio-pad > div > section {
      flex-basis: 50%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      border: 2px solid #d8d8d8;
    }

    /* space between column */
    .hyperaudio-pad > div > section + section {
      margin-left: 2em;
    }

    .hyperaudio-pad > div > section > article {
      /* flex-basis: 100%; */
    }

    /* selection colour */
    ::selection {
      background: #87d8e7;
      text-shadow: none;
    }

    /* effects: default no show */
    .hyperaudio-effect {
      display: none;
    }

    /* effects: show in right pad only */
    .hyperaudio-sink .hyperaudio-effect {
      display: block;
      background-color: #f4f4f4;
      padding: 10px;
      margin-left: 1em;
      margin-right: 1em;
    }

    /* FIXME */
    .hyperaudio-sink .hyperaudio-effect {
      display: none;
    }

    .hyperaudio-sink .hyperaudio-effect[data-type] {
      display: block;
    }

    .hyperaudio-sink .hyperaudio-effect {
      display: none;
    }

    .hyperaudio-effect > label {
      display: flex;
      flex-wrap: nowrap;
      align-items: baseline;
    }

    .hyperaudio-effect input {
      display: none;
    }

    /* vertical alingn fix for slider */
    .hyperaudio-effect > label .hyperaudio-range {
      flex-grow: 1;
      padding-bottom: 3px;
      padding-left: 10px;
      padding-right: 10px;
    }

    /* fix for duplication on DnD reordering */
    .rangeslider + .rangeslider {
      display: none;
    }

    .hyperaudio-sink .hyperaudio-effect:focus {
      outline: none;
    }

    /* transcript blocks */
    .hyperaudio-source .hyperaudio-transcript {
      border-left: 1px solid transparent;
      border-right: 1px solid transparent;
      padding-left: 1em;
      padding-right: 1em;
      outline: none;
    }

    .hyperaudio-sink .hyperaudio-transcript {
      border-left: 1px solid transparent;
      border-right: 1px solid transparent;
      padding-left: 1em;
      padding-right: 1em;
      outline: none;
    }

    .hyperaudio-sink .hyperaudio-transcript:focus {
      /* border-left: 1px solid red; */
      border-right: 1px solid transparent;
      padding-left: 1em;
      padding-right: 1em;
      outline: none;
    }

    /* border-top is a "drop zone" effect */
    .hyperaudio-transcript {
      border-top: 0 solid #e9f8fb;
      transition: border-top 0.15s;
      background-color: white;
    }

    /* .hyperaudio-transcript:last-child {
      border-bottom: 0 solid #e9f8fb;
      transition: border-bottom 0.15s;
    } */

    .hyperaudio-sink .hyperaudio-transcript.hyperaudio-over {
      border-top: 2em solid #e9f8fb;
      transition: border-top 0.15s;
    }

    .hyperaudio-sink article.hyperaudio-over {
      /* background-color: #e9f8fb; */
      padding-bottom: 5em;
    }

    /* .hyperaudio-sink article.hyperaudio-over .hyperaudio-transcript:last-child::after {
      display: block;
      content: 'append here…';
      border-bottom: 4em solid #e9f8fb;
      transition: border-bottom 0.15s;
    }

    .hyperaudio-sink article.hyperaudio-over .hyperaudio-transcript.hyperaudio-over:last-child::after {
      display: none;
      border-bottom: 0 solid #e9f8fb;
      transition: border-bottom 0.15s;
    } */

    /* container for media */
    .hyperaudio-player header {
      /* background-color: #f4f4f4; */
      background-color: black;
    }

    /* hide img placeholder once we have media */
    .hyperaudio-player header video + img, .hyperaudio-player header audio + img {
      display: none;
    }

    /* keep selection cursor as text for left pad */
    .hyperaudio-player:not(.hyperaudio-source) *[data-t] {
        cursor: pointer;
    }

    /* media, clickable hint */
    .hyperaudio-player video, .hyperaudio-player audio {
      width: 100%;
      height: auto;
      cursor: pointer;
    }

    .hyperaudio-player p {
      margin: 0;
      padding: .5em 0;
      line-height: 1.66em;
    }

    /* speaker name */
    .hyperaudio-player .speaker {
      font-weight: bold;
      color: black;
      margin-right: .3em;
    }

    /* speaker decoration */
    .hyperaudio-player .speaker::after {
      /* content: ':'; */
      /* margin-right: .2em; */
    }

    /* active section */
    .hyperaudio-player .hyperaudio-active {
      color: #d74b36;
    }

    /* text selection */
    .hyperaudio-source .hyperaudio-selected, hyperaudio-player .hyperaudio-active.hyperaudio-selected {
      background: #87d8e7;
      text-shadow: none;
    }

    .hyperaudio-fade {
      opacity: 0;
    }

    /* right pad buttons */
     div.hyperaudio-buttons {
       display: flex;
       background-color: #f4f4f4;
       padding: 10px;
     }

     div.hyperaudio-buttons > div, .hyperaudio-buttons > button {
       height: 38px;
       border: 1px solid #d3d3d3;
       flex-grow: 1;
       font-size: 1rem;
       font-family: sans-serif;
       text-align: center;
     }

     div.hyperaudio-buttons > div {
       background-color: white;
       padding-top: 10px;
     }

     div.hyperaudio-buttons > div + div, div.hyperaudio-buttons > div + button, div.hyperaudio-buttons > button + button {
       margin-left: 10px;
     }

     .hyperaudio-buttons > button {
       background-color: #e10600;
       color: white;
     }

    .hyperaudio-source input {
      width: 100%;
    }

    /* default "played" colour */
    section.hyperaudio-transcript {
      color: black;
    }

    /* unplayed colour */
    section.hyperaudio-current {
      color: #658898;
      border-left: 10px solid red !important;
    }

    /* played words in current segment */
    section.hyperaudio-current .hyperaudio-past {
      color: black;
    }

    /* unplayed colour for future segments */
    section.hyperaudio-current ~ section.hyperaudio-transcript {
      color: #658898;
      border-right: 10px solid blue;
    }

    /* player ui: buttons, progress */
    div.hyperaudio-transport {
      /* flex-direction: row; */
      display: flex;
      background-color: #191919;
      color: #aaaaaa;
      height: 32px;
      align-items: baseline;
    }

    /* hide/show play/pause */
    .hyperaudio-pause-button {
      display: none;
    }

    .hyperaudio-playing .hyperaudio-play-button {
      display: none;
    }

    .hyperaudio-playing .hyperaudio-pause-button {
      display: block;
    }


    /* .hyperaudio-controls {
    } */

    /* progress bar */
    .hyperaudio-progress {
      flex-grow: 1;
      background-color: #dbdddc;
      height: 6px;
      cursor: pointer;
    }

    .hyperaudio-progress-bar {
      background-color: #e10600;
      height: 6px;
      cursor: pointer;
    }

    /* .hyperaudio-time {
    } */

    /* left-pad search box wrapper */
    div.hyperaudio-search {
      background-color: #f4f4f4;
      display: block;
      padding: 10px;
    }

    div.hyperaudio-search input {
      height: 38px;
      border: 1px solid #d3d3d3;
      font-size: 24px !important;
      font-family: sans-serif !important;
    }

    /* left pad transcript itle */
    div.hyperaudio-title {
      padding-left: 1em;
      padding-right: 1em;
    }

    .hyperaudio-player > div.hyperaudio-title > h1 {
      font-size: 24px;
      line-height: 1.66em;
    }

    /* hide title if empty */
    .hyperaudio-player > div.hyperaudio-title > h1:empty {
      display: none;
    }


    /* .hyperaudio-match-start {
      background-color: lightyellow;
      border-top: 1px solid red;
    }

    .hyperaudio-match-end {
      background-color: lightyellow;
      border-bottom: 1px solid blue;
    }

    .hyperaudio-nomatch {
      background-color: red;
      outline: 1px solid red;
    }

    .hyperaudio-overlap {
      background-color: lightpink;
      border-top: 1px solid blue;
    }

    .hyperaudio-samestart {
      background-color: lightpink;
      border-bottom: 1px solid red;
    } */

    /* transcript zone size and scrollbar */
    .hyperaudio-player article {
      height: 350px;
      overflow-y: scroll;
      margin: 10px;
    }

    .hyperaudio-player article::-webkit-scrollbar {
      width: 5px;
    background-color: #a6a9aa;
    }

    .hyperaudio-player article::-webkit-scrollbar-thumb {
      background-color: #e10600;
      height: 80px;
    }

    .hyperaudio-player article::-webkit-scrollbar-track {
      background-color: #a6a9aa;
    }

    div.hyperaudio-drag {
      position: absolute;
      top: 0;
      left: -1000px;
      background-color: yellow;
      outline: 1px solid red;
    }

  </style>

</head>
<body>
  <div class="hyperaudio-pad">
  <div>
    <!-- Player -->
    <section id="player" class="hyperaudio-player hyperaudio-source">
      <header class="hyperaudio-media">
        <img src="https://studsterkel.wfmt.com/modules/starchive/starchive/images/stra-program-transcript.jpg" />
      </header>
      <div class="hyperaudio-transport-wrapper">
        <div class="hyperaudio-transport">
          <div class="hyperaudio-controls">
            <a class="hyperaudio-play-button">play</a>
            <a class="hyperaudio-pause-button">pause</a>
          </div>
          <div class="hyperaudio-progress">
            <div class="hyperaudio-progress-bar" style="width: 0%"></div>
          </div>
          <div class="hyperaudio-time">
            <span class="hyperaudio-elapsed"></span>
            <span class="hyperaudio-duration"></span>
          </div>
        </div>
      </div>
      <div class="hyperaudio-search">
        <input id="transcript-search" type="search" />
      </div>
      <article>
        <div class="hyperaudio-title">
          <h1></h1>
        </div>
      </article>
      <div class="hyperaudio-drag"></div>
    </section>

    <!-- Remixer -->
    <section id="remixer" class="hyperaudio-player hyperaudio-sink">
      <header class="hyperaudio-media">
        <img src="https://studsterkel.wfmt.com/modules/starchive/starchive/images/stra-program-transcript.jpg" />
      </header>
      <div class="hyperaudio-transport-wrapper">
        <div class="hyperaudio-transport">
          <div class="hyperaudio-controls">
            <a class="hyperaudio-play-button">play</a>
            <a class="hyperaudio-pause-button">pause</a>
          </div>
          <div class="hyperaudio-progress">
            <div class="hyperaudio-progress-bar" style="width: 0%"></div>
          </div>
          <div class="hyperaudio-time">
            <span class="hyperaudio-elapsed"></span>
            <span class="hyperaudio-duration"></span>
          </div>
        </div>
      </div>
      <div class="hyperaudio-buttons-wrapper">
        <div class="hyperaudio-buttons">
          <div class="hyperaudio-effect-source" data-type="fade">Fade</div>
          <div class="hyperaudio-effect-source" data-type="trim">Trim</div>
          <button class="hyperaudio-twitter-share">Share on Twitter</button>
          <button class="hyperaudio-fb-share">Share on Facebook</button>
        </div>
      </div>

      <article>
        <section class="hyperaudio-effect"></section>
      </article>
    </section>

  </div>
  </div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/easy-autocomplete/1.3.5/jquery.easy-autocomplete.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.5.2/qs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rangeslider.js/2.3.2/rangeslider.js"></script>
  <script src="hyperaudio.js"></script>


  <script>
    function remixInit() {
      $('#transcript-search').easyAutocomplete({
        placeholder: 'search titles…',
        url: function(phrase) {
          return 'https://api.contextubot.net/proxy?url=' + escape('https://live-stra-jell.pantheonsite.io/api/programs/search/?_format=json&keywords=' + escape(phrase)) ;
        },
        getValue: 'title',
        requestDelay: 100,
        adjustWidth: false,
        list: {
          maxNumberOfElements: 32,
          match: { enabled: true },
          onChooseEvent: function() {
            var nid = $('#transcript-search').getSelectedItemData().nid;
            $('#transcript-search').val('');
            loadTranscript(nid, null);
          }
        }
      });

      $(".hyperaudio-twitter-share").on("click", function() {
        window.open("https://twitter.com/share?url=" + escape(window.HyperaudioURL) + "&text=" + escape(document.title), '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');
        return false;
      });

      $(".hyperaudio-fb-share").on("click", function() {
        window.open("https://www.facebook.com/sharer/sharer.php?u=" + escape(window.HyperaudioURL) + "&t=" + escape(document.title), '',
          'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');
          return false;
      });

      function loadTranscript(nid, starchiveId) {
        $('.hyperaudio-title h1').empty();
        $('.hyperaudio-source article').empty().append('<p>loading…</p>');

        var url = 'https://api.contextubot.net/proxy?url=' + escape('https://live-stra-jell.pantheonsite.io/api/programs/nid/' + nid + '?_format=json');
        if (starchiveId) {
          url = 'https://api.contextubot.net/proxy?url=' + escape('https://live-stra-jell.pantheonsite.io/api/programs/starchiveid/' + starchiveId + '?_format=json');
        }

        $.get(url, function(data) {
          var transcript = JSON.parse(data[0].transcript);
          if (data[0].starchive_id) starchiveId = data[0].starchive_id;
          if (data[0].nid) nid = data[0].nid;

          // console.log(transcript);
          // $('.hyperaudio-title h1').text(transcript.title);

          var $section = $('<section></section>');
          $section.addClass('hyperaudio-transcript')
            .attr('data-src', transcript.media.mp4)
            .attr('data-poster', transcript.poster.url)
            .attr('data-id', starchiveId)
            .attr('data-type', 'video');

          window.transcriptRenderer(transcript.content, document, $section[0], 'T', true, 3);

          // $section.find('span[data-t]').toArray().forEach(function (token, i, arr) {
          //   if (i === 0) return;
          //   var prev = arr[i - 1];
          //   var t0 = $(prev).attr('data-t').split(',').map(function(v) { return parseFloat(v) });
          //   var t1 = $(token).attr('data-t').split(',').map(function(v) { return parseFloat(v) });
          //
          //   if (t0[0] === t1[0]) {
          //     $(prev).addClass('hyperaudio-samestart').attr('title', t0[0] + ' - ' + (t0[0] + t0[1]));
          //     $(token).attr('title', t1[0] + ' - ' + (t1[0] + t1[1]));
          //   }
          //
          //   if (t0[0] + t0[1] > t1[0]) {
          //     $(prev).addClass('hyperaudio-overlap').attr('title', t0[0] + ' - ' + (t0[0] + t0[1]));
          //     $(token).attr('title', t1[0] + ' - ' + (t1[0] + t1[1]));
          //   }
          // });

          $('.hyperaudio-source article').empty().append('<div class="hyperaudio-title"><h1></h1></div>');
          $('.hyperaudio-title h1').text(transcript.title);
          $('.hyperaudio-source article').append($section);
          document.querySelectorAll('.hyperaudio-source').forEach(function(sourceNode) { new window.Source(sourceNode); });
        });
      }

      function loadHATranscript(hid) {
        $('.hyperaudio-source article').empty().append('<p>loading…</p>');

        var url = 'https://studsterkel.api.hyperaudio.net/v1/transcripts/' + hid + '?format=json';

        $.get(url, function(data) {
          var transcript = data;
          var starchiveId = hid; // FIMXE

          var $section = $('<section></section>');
          $section.addClass('hyperaudio-transcript')
            .attr('data-src', transcript.media.source.mp4.url)
            .attr('data-id', starchiveId)
            .attr('data-type', 'video');

          window.transcriptRenderer(transcript.content, document, $section[0], 'T', true, 3);

          $('.hyperaudio-source article').empty().append($section);
          document.querySelectorAll('.hyperaudio-source').forEach(function(sourceNode) { new window.Source(sourceNode); });
        });
      }

      function loadSegments(segments, anchors) {
        var segment = segments.pop();
        var starchiveId = segment.split(':')[0];
        var interval = segment.split(':')[1].split(',').map(function(v) { return parseFloat(v); });

        var anchor = anchors ? anchors.pop() : null;
        var url = 'https://api.contextubot.net/proxy?url=' + escape('https://live-stra-jell.pantheonsite.io/api/programs/starchiveid/' + starchiveId + '?_format=json');

        $.get(url, function(data) {
          var transcript = JSON.parse(data[0].transcript);
          if (data[0].starchive_id) starchiveId = data[0].starchive_id;
          if (data[0].nid) nid = data[0].nid;

          var $section = $('<section></section>');
          $section.addClass('hyperaudio-transcript')
            .attr('data-src', transcript.media.mp4)
            .attr('data-id', starchiveId)
            .attr('data-type', 'video');

          window.transcriptRenderer(transcript.content, document, $section[0], 'T', true, 3);

          $section.find('p').each(function(i, p) {
            var start = parseFloat($(p).find('span[data-t]').first().data('t').split(',')[0]);
            var end = $(p).find('span[data-t]').last().data('t').split(',').reduce(function(acc, v) { return acc + parseFloat(v); }, 0);
            // console.log(start, end, interval, p);

            if (end <= interval[0] || start >= interval[1]) {
              $(p).remove();
            } else {
              $(p).find('span[data-t]').each(function(i, w) {
                var t = $(w).data('t').split(',').map(function(v) { return parseFloat(v); });
                var s = t[0];
                var e = t[0] + t[1];
                if (s < interval[0] || s >= interval[1]) {
                  $(w).remove();
                }
              });
            }
          });

          if (anchor && anchor.split(':')[0] === starchiveId) {
            var prefixString = anchor.split(':')[1].split(',')[0];
            var prefix = prefixString.split(/(?=[A-Z])/);
            var suffixString = anchor.split(':')[1].split(',')[1];
            var suffix = suffixString.split(/(?=[A-Z])/);
            // console.log(prefix, suffix);

            var tokens = $section.find('span[data-t]').toArray();
            for (var i = 0; i < tokens.length; i++) {
              var set = tokens.slice(i, i + prefix.length);
              var setString = set.map(function(t) {
                var root = t.textContent.replace(/[^\w\s]|_/g, '').replace(/\s+/g, '').toLowerCase().trim();
                return root.substr(0, 1).toUpperCase() + root.substr(1, 3);
              }).join('');
              // console.log(set, setString);

              if (setString === prefixString) {
                // console.log(set);
                $(set).addClass('hyperaudio-match-start');
                $(tokens.slice(0, i)).addClass('hyperaudio-nomatch').remove();
                break;
              }
            }

            tokens = tokens.reverse();
            for (var i = 0; i < tokens.length; i++) {
              var set = tokens.slice(i, i + suffix.length).reverse();
              var setString = set.map(function(t) {
                var root = t.textContent.replace(/[^\w\s]|_/g, '').replace(/\s+/g, '').toLowerCase().trim();
                return root.substr(0, 1).toUpperCase() + root.substr(1, 3);
              }).join('');
              // console.log(set, setString);

              if (setString === suffixString) {
                // console.log(set);
                $(set).addClass('hyperaudio-match-end');
                $(tokens.slice(0, i)).addClass('hyperaudio-nomatch').remove();
                break;
              }
            }
          }

          var player = false;
          var $article = $('.hyperaudio-sink article');
          if ($article.length === 0) {
            player = true;
            $article = $('.hyperaudio-player article');
          }

          $article.append($section);

          if (segment.split(':').length > 2) {
            var effect = segment.split(':')[2];
            var effectName = effect.startsWith('f') ? 'fade' : 'trim';
            var effectValue = parseFloat(effect.substring(1));
            var $template = $(window.SinkTemplates[effectName]);

            $template.attr('data-value', effectValue);
            $template.find('span').text(effectValue);
            $template.find('input').val(effectValue);
            $article.append($template);
          }
          if (segment.split(':').length > 3) {
            var effect = segment.split(':')[3];
            var effectName = effect.startsWith('f') ? 'fade' : 'trim';
            var effectValue = parseFloat(effect.substring(1));
            var $template = $(window.SinkTemplates[effectName]);

            $template.attr('data-value', effectValue);
            $template.find('span').text(effectValue);
            $template.find('input').val(effectValue);
            $article.append($template);
          }

          if (segments.length > 0) {
            loadSegments(segments, anchors);
          } else if (player) {
            document.querySelectorAll('.hyperaudio-player').forEach(function(playerNode) { new window.Player(playerNode); });
          } else {
            document.querySelectorAll('.hyperaudio-sink').forEach(function(sinkNode) { new window.Sink(sinkNode); });
          }
        });
      }

      var query = Qs.parse(document.location.search.indexOf('?') === 0 ? document.location.search.substring(1) : document.location.search);
      if (query.nid || query.id) loadTranscript(query.nid, query.id);
      if (query.hid) loadHATranscript(query.hid);
      if (query.r) {
        $('.hyperaudio-sink article').empty();
        loadSegments(query.r.split(';').reverse(), query.a ? query.a.split(';').reverse() : null);
      } else {
        document.querySelectorAll('.hyperaudio-sink').forEach(function(sinkNode) { new window.Sink(sinkNode); });
      }

    }

    $(remixInit);
  </script>




</body>
</html>
